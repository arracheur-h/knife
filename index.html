<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knife Simulator - FPS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
        }

        #gameCanvas {
            display: block;
            background: #1a1a1a;
        }

        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            color: white;
            font-family: monospace;
        }

        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        #weaponInfo {
            position: absolute;
            bottom: 30px;
            right: 30px;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 10px;
            border: 3px solid #00ffff;
        }

        #controls {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #ffaa00;
            font-size: 14px;
        }

        #controls h3 {
            margin-bottom: 10px;
            color: #ffaa00;
        }

        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 4px solid #00ffff;
        }

        #instructions h1 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 36px;
        }

        #instructions p {
            margin: 10px 0;
            font-size: 18px;
        }

        #startBtn {
            pointer-events: all;
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: #00ffff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        #startBtn:hover {
            background: #00cccc;
            transform: scale(1.1);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="hud">
        <div id="crosshair"></div>
        
        <div id="weaponInfo">
            üî™ Arme: <span id="weaponName">Karambit</span>
        </div>

        <div id="controls">
            <h3>üéÆ CONTR√îLES</h3>
            <p>üñ±Ô∏è Souris = Regarder autour</p>
            <p>‚å®Ô∏è ZQSD / WASD = D√©placer</p>
            <p>üñ±Ô∏è Clic Gauche = Attaque</p>
            <p>üñ±Ô∏è Clic Droit = Inspecter</p>
            <p>‚å®Ô∏è 1 = Karambit</p>
            <p>‚å®Ô∏è 2 = Papillon</p>
            <p>‚å®Ô∏è F = Animation flip</p>
        </div>

        <div id="instructions">
            <h1>üî™ KNIFE SIMULATOR üî™</h1>
            <p>Explorez et jouez avec vos couteaux !</p>
            <p>Changez d'arme et testez les animations</p>
            <button id="startBtn">COMMENCER</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Variables du jeu
        let gameActive = false;
        let mouseX = 0;
        let mouseY = 0;
        let cameraYaw = 0;
        let cameraPitch = 0;
        let isPointerLocked = false;

        // Position du joueur
        const player = {
            x: 0,
            y: 1.7, // Hauteur des yeux (1.7m)
            z: 0,
            vx: 0,
            vz: 0,
            speed: 0.1
        };

        // Touches enfonc√©es
        const keys = {};

        // √âtat de l'arme
        let currentWeapon = 'karambit';
        let attackAnimation = 0;
        let inspectAnimation = 0;
        let flipAnimation = 0;
        let weaponBob = 0;

        // D√©marrage du jeu
        document.getElementById('startBtn').addEventListener('click', () => {
            document.getElementById('instructions').classList.add('hidden');
            canvas.requestPointerLock();
        });

        // Verrouillage du pointeur
        document.addEventListener('pointerlockchange', () => {
            isPointerLocked = document.pointerLockElement === canvas;
            if (isPointerLocked) {
                gameActive = true;
            }
        });

        // Mouvement de la souris
        document.addEventListener('mousemove', (e) => {
            if (!isPointerLocked) return;
            
            cameraYaw -= e.movementX * 0.002;
            cameraPitch -= e.movementY * 0.002;
            cameraPitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, cameraPitch));
        });

        // Clics de souris
        canvas.addEventListener('mousedown', (e) => {
            if (!gameActive) return;
            
            if (e.button === 0) { // Clic gauche
                attackAnimation = 1;
            } else if (e.button === 2) { // Clic droit
                inspectAnimation = 1;
            }
        });

        canvas.addEventListener('contextmenu', (e) => e.preventDefault());

        // √âv√©nements clavier
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            
            if (e.key === '1') {
                currentWeapon = 'karambit';
                document.getElementById('weaponName').textContent = 'Karambit';
            } else if (e.key === '2') {
                currentWeapon = 'butterfly';
                document.getElementById('weaponName').textContent = 'Papillon';
            } else if (e.key.toLowerCase() === 'f') {
                flipAnimation = 1;
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Mise √† jour du mouvement
        function updateMovement() {
            let moveX = 0;
            let moveZ = 0;

            if (keys['z'] || keys['w']) moveZ -= 1;
            if (keys['s']) moveZ += 1;
            if (keys['q'] || keys['a']) moveX -= 1;
            if (keys['d']) moveX += 1;

            if (moveX !== 0 || moveZ !== 0) {
                const angle = cameraYaw;
                player.vx = (moveX * Math.cos(angle) - moveZ * Math.sin(angle)) * player.speed;
                player.vz = (moveX * Math.sin(angle) + moveZ * Math.cos(angle)) * player.speed;
                weaponBob += 0.2;
            } else {
                player.vx *= 0.8;
                player.vz *= 0.8;
            }

            player.x += player.vx;
            player.z += player.vz;
        }

        // Dessiner le sol
        function drawGround() {
            const gridSize = 50;
            const cellSize = 2;

            ctx.fillStyle = '#2a2a2a';
            ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;

            for (let x = -gridSize; x <= gridSize; x++) {
                const screenX = projectX(x * cellSize, 0, 0);
                const screenY1 = projectY(x * cellSize, 0, -gridSize * cellSize);
                const screenY2 = projectY(x * cellSize, 0, gridSize * cellSize);
                
                ctx.beginPath();
                ctx.moveTo(screenX, screenY1);
                ctx.lineTo(screenX, screenY2);
                ctx.stroke();
            }

            for (let z = -gridSize; z <= gridSize; z++) {
                const screenY = projectY(0, 0, z * cellSize);
                const screenX1 = projectX(-gridSize * cellSize, 0, z * cellSize);
                const screenX2 = projectX(gridSize * cellSize, 0, z * cellSize);
                
                ctx.beginPath();
                ctx.moveTo(screenX1, screenY);
                ctx.lineTo(screenX2, screenY);
                ctx.stroke();
            }
        }

        // Projection simple
        function projectX(x, y, z) {
            const rx = x - player.x;
            const ry = y - player.y;
            const rz = z - player.z;

            const rotX = rx * Math.cos(cameraYaw) - rz * Math.sin(cameraYaw);
            const rotZ = rx * Math.sin(cameraYaw) + rz * Math.cos(cameraYaw);

            return canvas.width / 2 + (rotX / rotZ) * 500;
        }

        function projectY(x, y, z) {
            const rx = x - player.x;
            const ry = y - player.y;
            const rz = z - player.z;

            const rotX = rx * Math.cos(cameraYaw) - rz * Math.sin(cameraYaw);
            const rotZ = rx * Math.sin(cameraYaw) + rz * Math.cos(cameraYaw);
            const rotY = ry * Math.cos(cameraPitch) - rotZ * Math.sin(cameraPitch);

            return canvas.height / 2 - (rotY / rotZ) * 500;
        }

        // Dessiner la main
        function drawHand(offsetX, offsetY) {
            const baseX = canvas.width * 0.7 + offsetX;
            const baseY = canvas.height * 0.6 + offsetY;

            // Bras
            ctx.fillStyle = '#d4a574';
            ctx.fillRect(baseX + 60, baseY + 80, 40, 120);

            // Main
            ctx.beginPath();
            ctx.ellipse(baseX + 80, baseY + 70, 35, 45, 0, 0, Math.PI * 2);
            ctx.fill();

            // Doigts
            for (let i = 0; i < 4; i++) {
                ctx.fillRect(baseX + 50 + i * 15, baseY + 30 + i * 5, 12, 40);
            }

            // Pouce
            ctx.save();
            ctx.translate(baseX + 110, baseY + 70);
            ctx.rotate(-0.5);
            ctx.fillRect(0, 0, 12, 35);
            ctx.restore();
        }

        // Dessiner le Karambit
        function drawKarambit(offsetX, offsetY, rotation) {
            const baseX = canvas.width * 0.7 + offsetX;
            const baseY = canvas.height * 0.6 + offsetY;

            ctx.save();
            ctx.translate(baseX + 70, baseY + 50);
            ctx.rotate(rotation);

            // Anneau
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.arc(-30, -20, 15, 0, Math.PI * 2);
            ctx.stroke();

            // Manche
            ctx.fillStyle = '#2c2c2c';
            ctx.fillRect(-30, -10, 50, 20);
            
            ctx.fillStyle = '#ff6600';
            for (let i = 0; i < 5; i++) {
                ctx.fillRect(-25 + i * 10, -8, 8, 16);
            }

            // Lame courb√©e
            ctx.fillStyle = '#c0c0c0';
            ctx.beginPath();
            ctx.moveTo(20, 0);
            ctx.quadraticCurveTo(50, -15, 70, -40);
            ctx.lineTo(65, -45);
            ctx.quadraticCurveTo(45, -20, 20, -5);
            ctx.closePath();
            ctx.fill();

            // Reflet de la lame
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.moveTo(25, -2);
            ctx.quadraticCurveTo(50, -17, 68, -42);
            ctx.lineTo(67, -43);
            ctx.quadraticCurveTo(48, -18, 25, -3);
            ctx.closePath();
            ctx.fill();

            ctx.restore();
        }

        // Dessiner le Papillon
        function drawButterfly(offsetX, offsetY, rotation, openAngle) {
            const baseX = canvas.width * 0.7 + offsetX;
            const baseY = canvas.height * 0.6 + offsetY;

            ctx.save();
            ctx.translate(baseX + 70, baseY + 50);
            ctx.rotate(rotation);

            // Lame centrale
            ctx.fillStyle = '#c0c0c0';
            ctx.fillRect(-5, -60, 10, 80);
            
            // Pointe
            ctx.beginPath();
            ctx.moveTo(-5, -60);
            ctx.lineTo(0, -80);
            ctx.lineTo(5, -60);
            ctx.closePath();
            ctx.fill();

            // Reflet
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.fillRect(-3, -60, 3, 80);

            // Manche gauche
            ctx.save();
            ctx.translate(-5, 0);
            ctx.rotate(-openAngle);
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(-30, -10, 35, 20);
            ctx.fillStyle = '#00ccff';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(-28 + i * 10, -8, 8, 16);
            }
            ctx.restore();

            // Manche droit
            ctx.save();
            ctx.translate(5, 0);
            ctx.rotate(openAngle);
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(-5, -10, 35, 20);
            ctx.fillStyle = '#00ccff';
            for (let i = 0; i < 3; i++) {
                ctx.fillRect(-3 + i * 10, -8, 8, 16);
            }
            ctx.restore();

            ctx.restore();
        }

        // Mettre √† jour les animations
        function updateAnimations() {
            if (attackAnimation > 0) {
                attackAnimation -= 0.05;
                if (attackAnimation < 0) attackAnimation = 0;
            }

            if (inspectAnimation > 0) {
                inspectAnimation -= 0.02;
                if (inspectAnimation < 0) inspectAnimation = 0;
            }

            if (flipAnimation > 0) {
                flipAnimation -= 0.03;
                if (flipAnimation < 0) flipAnimation = 0;
            }
        }

        // Boucle de rendu
        function render() {
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height / 2);
            
            drawGround();

            if (gameActive) {
                updateMovement();
                updateAnimations();

                const bobOffset = Math.sin(weaponBob) * 5;
                let offsetX = bobOffset;
                let offsetY = bobOffset;
                let rotation = 0;
                let openAngle = 0;

                // Animation d'attaque
                if (attackAnimation > 0) {
                    const progress = 1 - attackAnimation;
                    offsetX += Math.sin(progress * Math.PI) * -100;
                    rotation += Math.sin(progress * Math.PI) * 1.5;
                }

                // Animation d'inspection
                if (inspectAnimation > 0) {
                    const progress = Math.sin(inspectAnimation * Math.PI);
                    rotation += progress * Math.PI * 2;
                    offsetX -= progress * 100;
                }

                // Animation flip
                if (flipAnimation > 0) {
                    rotation += (1 - flipAnimation) * Math.PI * 4;
                    offsetY += Math.sin((1 - flipAnimation) * Math.PI) * 50;
                }

                drawHand(offsetX, offsetY);

                if (currentWeapon === 'karambit') {
                    drawKarambit(offsetX, offsetY, rotation);
                } else if (currentWeapon === 'butterfly') {
                    openAngle = inspectAnimation > 0 ? Math.PI / 3 : 0;
                    if (flipAnimation > 0) {
                        openAngle = Math.PI / 2;
                    }
                    drawButterfly(offsetX, offsetY, rotation, openAngle);
                }
            }

            requestAnimationFrame(render);
        }

        render();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
